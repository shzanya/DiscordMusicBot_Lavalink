# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —ç–º–æ–¥–∑–∏

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—à–∏–±–∫–∞ "keywords must be strings"

- **–ü—Ä–æ–±–ª–µ–º–∞**: `mongo_service.get_guild_settings()` –≤–æ–∑–≤—Ä–∞—â–∞–ª –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
- **–§–∞–π–ª**: `core/events/track_events.py`

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å —ç–º–æ–¥–∑–∏ –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä–µ

- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —ç–º–æ–¥–∑–∏, –ø–æ—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ
- **–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è view
- **–§–∞–π–ª**: `ui/views.py`

### 3. –≠–º–æ–¥–∑–∏ –≤ MusicPlayerView –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ —Ç–æ—á–∫–∏

- **–ü—Ä–æ–±–ª–µ–º–∞**: –≠–º–æ–¥–∑–∏ –≤ MusicPlayerView –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ —Ç–æ—á–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —ç–º–æ–¥–∑–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è view
- **–§–∞–π–ª**: `ui/views.py`

### 4. –≠–º–æ–¥–∑–∏ –≤ QueueView –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ —Ç–æ—á–∫–∏

- **–ü—Ä–æ–±–ª–µ–º–∞**: –≠–º–æ–¥–∑–∏ –≤ QueueView –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ —Ç–æ—á–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–º–æ–¥–∑–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ view –∏ –ø–µ—Ä–µ–¥–∞—á–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ playback.py
- **–§–∞–π–ª**: `ui/views.py`

### HarmonyPlayer.play_track() (commands/music/playback.py)

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–ª—è `track.requester` –≤ –º–µ—Ç–æ–¥–µ `play_track()`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ fallback –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ requester –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ requester –≤ `MusicPlayerView.create()` –∏ `send_now_playing_message()`

### HarmonyPlayer.do_next() (commands/music/playback.py)

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–ª—è `track.requester` –≤ –º–µ—Ç–æ–¥–µ `do_next()`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ requester –≤ `player.play_track()`

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

```python
# –ë—ã–ª–æ:
settings = await mongo_service.get_guild_settings(guild_id)
color = settings.get("color", "default")
custom_emojis = settings.get("custom_emojis", None)

# –°—Ç–∞–ª–æ:
settings = await mongo_service.get_guild_settings(guild_id)
if not isinstance(settings, dict):
    settings = {}
color = settings.get("color", "default")
custom_emojis = settings.get("custom_emojis", {})
if not isinstance(custom_emojis, dict):
    custom_emojis = {}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –≤ view

```python
# –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ create() –º–µ—Ç–æ–¥:
self._update_all_emojis()  # –û–±–Ω–æ–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
```

### MusicPlayerView (ui/views.py)

- –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `self._update_all_emojis()` –≤ –∫–æ–Ω—Ü–µ –º–µ—Ç–æ–¥–∞ `create()`
- –£–±—Ä–∞–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ (—Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å—Ä–∞–∑—É)

### QueueView (ui/views.py)

- –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `self._update_all_emojis()` –≤ –∫–æ–Ω—Ü–µ –º–µ—Ç–æ–¥–∞ `create()`
- –£–±—Ä–∞–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ (—Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å—Ä–∞–∑—É)
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_update_all_emojis()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫

### HarmonyPlayer.show_queue() (commands/music/playback.py)

- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≥–∏–ª—å–¥–∏–∏ –¥–ª—è —ç–º–æ–¥–∑–∏
- –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ `color` –∏ `custom_emojis` –≤ `QueueView.create()`

### TrackStartEvent (core/events/track_events.py)

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–ª—è `track.requester`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ fallback –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ requester –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ requester –≤ `MusicPlayerView.create()` –∏ `send_now_playing_message()`

### TrackEndEvent (core/events/track_events.py)

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–ª—è `track.requester` –≤ –º–µ—Ç–æ–¥–µ `_handle_queue_logic`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ requester –≤ `player.play_track()`

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —ç–º–æ–¥–∑–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å —Ü–≤–µ—Ç–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ view, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–∂–∏–º–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫–∏. –¢–∞–∫–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "keywords must be strings" –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Å–æ–±—ã—Ç–∏–π —Ç—Ä–µ–∫–æ–≤.

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### HarmonyPlayer.play_by_index() (commands/music/playback.py)

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–ª—è `track.requester` –≤ –º–µ—Ç–æ–¥–µ `play_by_index()`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ requester –≤ `player.play_track()`

#### MusicPlayerView –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ (ui/views.py)

- –£–±—Ä–∞–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –∏–∑ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ (pause_button, skip_button)
- –≠–º–æ–¥–∑–∏ —Ç–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—É–∑–∞/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ)
- –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –ø–æ–∫–∞–∑–æ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö —ç–º–æ–¥–∑–∏ –ø–µ—Ä–µ–¥ —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

–ü—Ä–æ–±–ª–µ–º–∞ —Å —ç–º–æ–¥–∑–∏ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ Discord —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–ª view —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ —ç–º–æ–¥–∑–∏, –∞ –ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–ª—è–ª –∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ. –¢–µ–ø–µ—Ä—å —ç–º–æ–¥–∑–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ view.

–¢–µ–ø–µ—Ä—å —ç–º–æ–¥–∑–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å —Ü–≤–µ—Ç–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ view, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞–∂–∏–º–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫–∏.

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –í `core/events/track_events.py` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≥–∏–ª—å–¥–∏–∏
- –í `commands/music/playback.py` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –æ—á–µ—Ä–µ–¥–∏
- –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–º–æ–¥–∑–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —ç–º–æ–¥–∑–∏ –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä–µ

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–º–æ–¥–∑–∏
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–∞–∫ None** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π get_emoji** - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `config/constants.py`

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–º–æ–¥–∑–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
